import{d as re,r as c,I as se,u as A,b as ue,e as de,aA as ie,aB as ne,aD as V,aC as pe,aE as me,aF as h,aG as ce,N as _e,c as I,j as t,k as s,h as r,V as n,l as ve,i as L,F as Q,o as w,g as p,aU as fe,f as o,m as be,t as d,aI as x,aV as ge,aW as ye,A as R,B as z,C as K,aX as Ve,aK as he,aL as we,aH as F,aJ as Ce,H as Ie}from"./index-sE9P4Q9O.js";import{_ as xe}from"./OrderDetails.vue_vue_type_script_setup_true_lang-8rhbMVsx.js";import{_ as Ne}from"./DeleteIcon.vue_vue_type_script_setup_true_lang-1ZPx5IJG.js";import{a as ke,p as Te}from"./orders-service-DZtj4z2A.js";import{a as qe}from"./format-date-q9jp0Fy1.js";import{g as Fe}from"./products-service-rn7XLkah.js";import{V as $e}from"./VSpacer-1dX4bruf.js";import{V as J}from"./VDialog-1Ku-f6d7.js";import{V as Be}from"./VAutocomplete-OZIwKkOo.js";import"./queryString-AL1HqB06.js";import"./formData-AERYmAuJ.js";import"./filter-ySkqEX_B.js";const Pe={class:"border-b-2 border-neutral-600 pb-1 w-fit"},Se=o("div",null,null,-1),De={class:"flex items-start gap-6"},Ee={class:"flex justify-end"},Ue={class:"mt-2 w-3/4 rounded-tl-lg bg-white shadow-md p-3 mb-6 text-xl"},je={class:"flex gap-8 mb-2"},Oe=o("p",null,"الإجمالي :",-1),Ae={class:"flex gap-8 mt-3"},Le=o("p",null,"تاريخ الدفع :",-1),Qe={key:0},Re={class:"flex gap-8 mt-3"},ze=o("p",null,"الإجمالي بعد الكوبون :",-1),Ke={class:"flex gap-8 mt-3"},Je=o("p",null,"معدل الفائدة :",-1),Me={class:"grid grid-cols-2 gap-4 mt-8"},He={class:"flex gap-3 justify-between mt-1"},Ge={class:"flex gap-x-3 justify-between mt-1"},We={class:"flex gap-3 justify-between mt-1"},na=re({__name:"EditCustomerOrder",setup(Xe){var O;const i=c([]),$=c([]),C=c([]),B=c([]),_=c([]),N=c(),f=c({open:!1,productId:0}),P=se(),M=Number(P.params.customerId),k=Number(P.params.orderId),{data:u}=A({queryKey:["orderDetails"],queryFn:()=>ke(k)}),{data:H,isPending:G}=A({queryKey:["products"],queryFn:()=>Fe({page:1,limit:200})}),W=ue(),S=de({mutationFn:({orderId:l,body:a})=>Te(l,a),onSuccess:()=>{Ie.replace({name:"view-customer-order"}),W.invalidateQueries({queryKey:["orderDetails"]})},onError:l=>{console.log(l)}}),X=ie(ne({debt_arrears:V().optional(),residual_value:V().optional(),paid_due_value:V().optional(),total_price_with_copupon:V().optional(),debt_ratio:V().optional(),due_date:pe().optional()})),{errors:T,setValues:Y,handleSubmit:Z}=me({validationSchema:X,initialValues:{due_date:(O=u.value)==null?void 0:O.order_details.due_date}}),{value:b}=h("debt_arrears"),{value:g}=h("residual_value"),{value:y}=h("paid_due_value"),{value:D}=h("total_price_with_copupon"),{value:E}=h("debt_ratio");ce(()=>{u.value&&(Y({debt_arrears:u.value.order_details.debt_arrears,paid_due_value:u.value.order_details.paid_due_value,residual_value:u.value.order_details.residual_value,total_price_with_copupon:u.value.order_details.total_price_with_copupon,debt_ratio:u.value.order_details.debt_ratio}),_.value=[...u.value.products],B.value=JSON.parse(u.value.order_details.color_selected),i.value=[...u.value.order_details.quantity_selected],u.value.products.forEach(l=>{$.value.push(l.price),C.value.push(l.product_code)}))});const ee=(l,a)=>`هل تريد حذف  ${l} من الطلبية  ${a} ؟`,ae=(l,a)=>{_.value=_.value.filter(e=>e.id!==a),i.value.splice(l,1),$.value.splice(l,1),C.value.splice(l,1)},U=_e(()=>_.value.reduce((l,a,e)=>l+a.price*(i.value[e]??0),0)),j=Z(l=>{const a={...l,product_codes:C.value,quantity_selected:i.value,total_price:U.value,color_selected:JSON.stringify(B.value)};S.mutate({body:a,orderId:k})}),q=()=>{b.value=Number(b.value),g.value=Number(g.value),y.value=Number(y.value),D.value=Number(D.value),E.value=Number(E.value)},te=l=>{i.value[l]=Number(i.value[l])},le=l=>{C.value.push(l.product_code),_.value.push(l)};return(l,a)=>(w(),I(Q,null,[t(n,{to:{name:"view-customer-order",params:{customerId:r(M),orderId:r(k)}},variant:"outlined",color:"primary",size:"large","prepend-icon":r(fe)},{default:s(()=>[p(" الرجوع الى عرض الطلب ")]),_:1},8,["to","prepend-icon"]),r(u)?(w(),ve(xe,{key:0,order:r(u)},{default:s(()=>[o("form",{class:"px-8 py-3",onSubmit:a[8]||(a[8]=Ce((...e)=>r(j)&&r(j)(...e),["prevent"]))},[(w(!0),I(Q,null,be(_.value,(e,v)=>(w(),I("div",{key:e.id,class:"grid grid-cols-4 items-start"},[o("p",Pe,d(e.name),1),t(x,{modelValue:i.value[v],"onUpdate:modelValue":m=>i.value[v]=m,class:"w-32",label:"الكمية",type:"number",variant:"outlined",color:"primary",placeholder:"الكمية",onInput:m=>te(v)},null,8,["modelValue","onUpdate:modelValue","onInput"]),Se,o("div",De,[o("p",null,d(e.price),1),t(J,{width:"500"},{activator:s(({props:m})=>[t(n,ge(ye(m)),{default:s(()=>[t(Ne,{fill:"fill-black","custom-style":"w-7 h-7 cursor-pointer"})]),_:2},1040)]),default:s(({isActive:m})=>[t(R,{title:ee(e.name,e.id),rounded:"lg",color:"#EFE9F5",style:{"padding-block":"1.75rem !important"}},{default:s(()=>[t(z,null,{default:s(()=>[p(" سيتم حذف عدد "+d(e.minimum_quantity)+" "+d(e.minimum_quantity===1?"عنصر":"عناصر")+" بقيمة "+d(e.price)+" د.ل من هذه الطلبية. لا يمكن التراجع عن هذه العملية. ",1)]),_:2},1024),t(K,null,{default:s(()=>[t($e),t(n,{text:"لا",onClick:oe=>m.value=!1},null,8,["onClick"]),t(n,{text:"نعم",onClick:oe=>{ae(v,e.id),m.value=!1}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024)])]))),128)),o("div",Ee,[t(n,{size:"small",rounded:"xl",variant:"elevated",color:"#004C6B",onClick:a[0]||(a[0]=e=>f.value.open=!0)},{default:s(()=>[p(" إضافة منتج ")]),_:1})]),t(J,{modelValue:f.value.open,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.open=e),class:"w-3/4 p-6"},{default:s(()=>[t(R,null,{default:s(()=>[t(Ve,null,{default:s(()=>[p("إضافة منتج للطلب")]),_:1}),t(z,null,{default:s(()=>{var e;return[t(Be,{modelValue:N.value,"onUpdate:modelValue":a[1]||(a[1]=v=>N.value=v),"hide-no-data":!1,"item-title":"name","item-value":"id","return-object":!0,items:(e=r(H))==null?void 0:e.data,loading:r(G),"hide-selected":"",label:"المنتجات",placeholder:"المنتجات",variant:"outlined",color:"primary","auto-select-first":""},{"no-data":s(()=>[t(he,null,{default:s(()=>[t(we,null,{default:s(()=>[p(" لا توجد نتائج ")]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]}),_:1}),t(K,null,{default:s(()=>[t(n,{color:"primary",type:"submit",variant:"tonal",onClick:a[2]||(a[2]=e=>{le(N.value),f.value.open=!1})},{default:s(()=>[p(" إضافة ")]),_:1}),t(n,{color:"error",type:"button",onClick:a[3]||(a[3]=e=>f.value.open=!1)},{default:s(()=>[p(" الغاء ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",Ue,[o("div",je,[Oe,o("p",null,d(U.value)+" د.ل",1)]),o("div",Ae,[Le,o("p",null,d(r(qe)(r(u).order_details.due_date)),1)]),r(u).order_details.payment_method=="installments"?(w(),I("div",Qe,[o("div",Re,[ze,o("p",null,d(r(u).order_details.total_price_with_copupon),1)]),o("div",Ke,[Je,o("p",null,d(r(u).order_details.debt_ratio),1)]),o("div",Me,[o("div",He,[t(x,{modelValue:r(b),"onUpdate:modelValue":a[5]||(a[5]=e=>F(b)?b.value=e:null),label:"متأخرات سداد الديون",placeholder:"متأخرات سداد الديون",type:"number",variant:"outlined","error-messages":r(T).debt_arrears,onInput:q},null,8,["modelValue","error-messages"])]),o("div",Ge,[t(x,{modelValue:r(y),"onUpdate:modelValue":a[6]||(a[6]=e=>F(y)?y.value=e:null),label:"المدفوع",placeholder:"المدفوع",type:"number",variant:"outlined","error-messages":r(T).paid_due_value,onInput:q},null,8,["modelValue","error-messages"])]),o("div",We,[t(x,{modelValue:r(g),"onUpdate:modelValue":a[7]||(a[7]=e=>F(g)?g.value=e:null),label:"الإجمالي بعد الإستحقاق",placeholder:"الإجمالي بعد الإستحقاق",type:"number",variant:"outlined","error-messages":r(T).residual_value,onInput:q},null,8,["modelValue","error-messages"])])])])):L("",!0)]),t(n,{size:"large",rounded:"xl",variant:"elevated",color:"#004C6B",type:"submit",loading:r(S).isPending.value},{default:s(()=>[p(" تحديث ")]),_:1},8,["loading"])],32)]),_:1},8,["order"])):L("",!0)],64))}});export{na as default};
