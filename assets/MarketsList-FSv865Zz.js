import{d as L,r as b,u as I,b as N,e as $,c as x,f as h,g as n,h as t,t as T,i as v,j as e,aI as K,k as a,V as i,l as V,F as U,o as u,p as j,s as z,y as g,D as O,E as G,aQ as H,b4 as J,x as R,z as W,A as X,B as Y,C as Z}from"./index-sE9P4Q9O.js";import{g as ee,c as ae,d as te}from"./markets-service-9CeRDKxI.js";import{d as oe}from"./index-AJYIkLwR.js";import{V as le,L as ne}from"./VDataTableServer-KxNtiX_H.js";import{B as m}from"./base-status-k7rMfTbK.js";import{V as f}from"./VTooltip-RkjaeBLA.js";import{V as se}from"./VDialog-1Ku-f6d7.js";import{V as ie}from"./VSpacer-1dX4bruf.js";import"./queryString-AL1HqB06.js";import"./formData-AERYmAuJ.js";import"./_commonjsHelpers-5-cIlDoe.js";import"./filter-ySkqEX_B.js";const re={class:"text-3xl font-medium"},ce={key:0,class:"bg-gray-200 px-2 rounded-lg text-2xl"},de={class:"flex justify-between mt-8"},ue={class:"w-72"},me={key:1,class:"shadow-lg rounded-lg mt-4 border border-gray-200"},pe={class:"flex gap-1"},Te=L({__name:"MarketsList",setup(ve){const _=b([]),k=b(""),r=b({page:1,limit:10,search_value:""}),c=I({queryKey:["markets",r],queryFn:()=>ee(r.value,k.value)}),B=[{title:"إسم المحل",value:"name",width:"300px",sortable:!1},{title:"إسم مالك المحل",value:"owner_name",width:"300px",sortable:!1},{title:"رقم الهاتف",value:"phone_number",width:"300px",sortable:!1},{title:"الحالة",key:"status",value:"active_market",width:"300px",sortable:!1},{title:"الإجرائات",key:"actions",width:"300px",sortable:!1}],C=N(),S=(l,s,p)=>{_.value[p]=!0,ae({id:l,active_market:s}).then(()=>C.invalidateQueries({queryKey:["markets"]})).finally(()=>_.value[p]=!1)},D=l=>l===m.Activated?"success":"error",E=l=>l===m.Activated?"مفعل":"غير مفعل",A=({page:l,limit:s})=>{r.value={...r.value,page:l??1,limit:s??10}},F=oe(()=>{r.value.search_value=k.value},300),M=$({mutationFn:te,onSuccess:()=>{C.invalidateQueries({queryKey:["markets"]})},onError:l=>{console.log(l)}}),P=l=>{M.mutate(l)},Q=l=>`حذف المحل ${l}# ؟`;return(l,s)=>{var p,w;return u(),x(U,null,[h("h2",re,[n(" المحلات "),((p=t(c).data.value)==null?void 0:p.data.length)>0?(u(),x("span",ce,T((w=t(c).data.value)==null?void 0:w.data.length),1)):v("",!0)]),h("div",de,[h("div",ue,[e(K,{modelValue:k.value,"onUpdate:modelValue":s[0]||(s[0]=o=>k.value=o),label:"البحث",variant:"outlined",color:"primary",clearable:"",placeholder:"البحث",density:"compact",onInput:t(F)},null,8,["modelValue","onInput"])]),e(i,{"append-icon":t(j),to:{name:"add-market"},color:"primary",variant:"elevated",rounded:"xl"},{default:a(()=>[n(" إضافة محل ")]),_:1},8,["append-icon"])]),t(c).isPending.value?(u(),V(ne,{key:0})):v("",!0),t(c).data.value?(u(),x("div",me,[e(le,{sticky:"","items-per-page":r.value.limit,page:r.value.page,headers:B,"items-length":t(c).data.value.total,items:t(c).data.value.data,loading:t(c).isPending.value,"onUpdate:options":s[1]||(s[1]=o=>A({page:o.page,limit:o.itemsPerPage}))},{"item.status":a(({value:o})=>[e(z,{color:D(o)},{default:a(()=>[n(T(E(o)),1)]),_:2},1032,["color"])]),"item.actions":a(({item:o,index:y})=>[h("div",pe,[o.active_market===t(m).Activated?(u(),V(i,{key:0,loading:_.value[y],variant:"tonal",class:"mx-1",density:"comfortable",icon:"",color:"warning",onClick:d=>S(o.id,t(m).Deactivated,y)},{default:a(()=>[e(g,{icon:t(O)},null,8,["icon"]),e(f,{activator:"parent",location:"bottom"},{default:a(()=>[n(" الغاء التفعيل ")]),_:1})]),_:2},1032,["loading","onClick"])):v("",!0),o.active_market===t(m).Deactivated?(u(),V(i,{key:1,loading:_.value[y],variant:"tonal",class:"mx-1",density:"comfortable",icon:"",color:"success",onClick:d=>S(o.id,t(m).Activated,y)},{default:a(()=>[e(g,{icon:t(G)},null,8,["icon"]),e(f,{activator:"parent",location:"bottom"},{default:a(()=>[n(" إعادة التفعيل ")]),_:1})]),_:2},1032,["loading","onClick"])):v("",!0),e(i,{to:{name:"market-details",params:{id:o.id}},variant:"tonal",class:"mx-1",density:"comfortable",icon:"",color:"primary"},{default:a(()=>[e(g,{icon:t(H)},null,8,["icon"]),e(f,{activator:"parent",location:"bottom"},{default:a(()=>[n(" عرض ")]),_:1})]),_:2},1032,["to"]),e(i,{to:{name:"edit-market",params:{id:o.id}},variant:"tonal",class:"mx-1",density:"comfortable",icon:"",color:"grey-darken-2"},{default:a(()=>[e(g,{icon:t(J)},null,8,["icon"]),e(f,{activator:"parent",location:"bottom"},{default:a(()=>[n(" تعديل ")]),_:1})]),_:2},1032,["to"]),e(se,{width:"500"},{activator:a(({props:d})=>[e(i,R(d,{variant:"text",class:"mx-1",density:"comfortable",icon:"",color:"error"}),{default:a(()=>[e(g,{icon:t(W)},null,8,["icon"]),e(f,{activator:"parent",location:"bottom"},{default:a(()=>[n(" حذف ")]),_:1})]),_:2},1040)]),default:a(({isActive:d})=>[e(X,{title:Q(o.name),rounded:"lg",color:"#EFE9F5",style:{"padding-block":"1.75rem !important"}},{default:a(()=>[e(Y,null,{default:a(()=>[n(" سيتم حذف هذه المحل بشكل نهائي . ")]),_:1}),e(Z,null,{default:a(()=>[e(ie),e(i,{text:"لا",onClick:q=>d.value=!1},null,8,["onClick"]),e(i,{text:"نعم",onClick:q=>{d.value=!1,P(o.id)}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024)])]),_:2},1032,["items-per-page","page","items-length","items","loading"])])):v("",!0)],64)}}});export{Te as default};
