import{d as oe,r as m,I as se,u as O,b as re,e as ue,aA as de,aB as ie,aD as V,aC as ne,aE as pe,aF as h,aG as ce,N as me,c as x,j as t,k as s,h as r,V as n,l as _e,i as A,F as L,o as w,g as p,aU as ve,f as o,m as fe,t as d,aI as k,aV as be,aW as ge,A as Q,B as R,C as z,aX as ye,aK as Ve,aL as he,aH as F,aJ as we,H as Ce}from"./index-sE9P4Q9O.js";import{_ as xe}from"./OrderDetails.vue_vue_type_script_setup_true_lang-8rhbMVsx.js";import{_ as ke}from"./DeleteIcon.vue_vue_type_script_setup_true_lang-1ZPx5IJG.js";import{a as Ne,p as Ie}from"./orders-service-DZtj4z2A.js";import{a as Te}from"./format-date-q9jp0Fy1.js";import{g as qe}from"./products-service-rn7XLkah.js";import{V as Fe}from"./VSpacer-1dX4bruf.js";import{V as K}from"./VDialog-1Ku-f6d7.js";import{V as $e}from"./VAutocomplete-OZIwKkOo.js";import"./queryString-AL1HqB06.js";import"./formData-AERYmAuJ.js";import"./filter-ySkqEX_B.js";const Be={class:"border-b-2 border-neutral-600 pb-1 w-fit"},De=o("div",null,null,-1),Pe={class:"flex items-start gap-6"},Se={class:"flex justify-end"},Ee={class:"mt-2 w-3/4 rounded-tl-lg bg-white shadow-md p-3 mb-6 text-xl"},Ue={class:"flex gap-8 mb-2"},je=o("p",null,"الإجمالي :",-1),Oe={class:"flex gap-8 mt-3"},Ae=o("p",null,"تاريخ الدفع :",-1),Le={key:0},Qe={class:"flex gap-8 mt-3"},Re=o("p",null," الإجمالي بعد الكوبون :",-1),ze={class:"flex gap-8 mt-3"},Ke=o("p",null,"معدل الفائدة :",-1),Je={class:"grid grid-cols-2 gap-4 mt-8"},Me={class:"flex gap-3 justify-between mt-1"},He={class:"flex gap-x-3 justify-between mt-1"},Ge={class:"flex gap-3 justify-between mt-1"},ia=oe({__name:"EditOrderDetails",setup(We){var j;const i=m([]),$=m([]),C=m([]),B=m([]),_=m([]),N=m(),f=m({open:!1,productId:0}),J=se(),I=Number(J.params.id),{data:u}=O({queryKey:["orderDetails"],queryFn:()=>Ne(I)}),{data:M,isPending:H}=O({queryKey:["products"],queryFn:()=>qe({page:1,limit:200})}),G=re(),D=ue({mutationFn:({id:l,body:a})=>Ie(l,a),onSuccess:()=>{Ce.replace({name:"order-details"}),G.invalidateQueries({queryKey:["orderDetails"]})},onError:l=>{console.log(l)}}),W=de(ie({debt_arrears:V().optional(),residual_value:V().optional(),paid_due_value:V().optional(),total_price_with_copupon:V().optional(),debt_ratio:V().optional(),due_date:ne().optional()})),{errors:T,setValues:X,handleSubmit:Y}=pe({validationSchema:W,initialValues:{due_date:(j=u.value)==null?void 0:j.order_details.due_date}}),{value:b}=h("debt_arrears"),{value:g}=h("residual_value"),{value:y}=h("paid_due_value"),{value:P}=h("total_price_with_copupon"),{value:S}=h("debt_ratio");ce(()=>{u.value&&(X({debt_arrears:u.value.order_details.debt_arrears,paid_due_value:u.value.order_details.paid_due_value,residual_value:u.value.order_details.residual_value,total_price_with_copupon:u.value.order_details.total_price_with_copupon,debt_ratio:u.value.order_details.debt_ratio}),_.value=[...u.value.products],B.value=JSON.parse(u.value.order_details.color_selected),i.value=[...u.value.order_details.quantity_selected],u.value.products.forEach(l=>{$.value.push(l.price),C.value.push(l.product_code)}))});const Z=(l,a)=>`هل تريد حذف  ${l} من الطلبية  ${a} ؟`,ee=(l,a)=>{_.value=_.value.filter(e=>e.id!==a),i.value.splice(l,1),$.value.splice(l,1),C.value.splice(l,1)},E=me(()=>_.value.reduce((l,a,e)=>l+a.price*(i.value[e]??0),0)),U=Y(l=>{const a={...l,product_codes:C.value,quantity_selected:i.value,total_price:E.value,color_selected:JSON.stringify(B.value)};D.mutate({body:a,id:I})}),q=()=>{b.value=Number(b.value),g.value=Number(g.value),y.value=Number(y.value),P.value=Number(P.value),S.value=Number(S.value)},ae=l=>{i.value[l]=Number(i.value[l])},te=l=>{C.value.push(l.product_code),_.value.push(l)};return(l,a)=>(w(),x(L,null,[t(n,{to:{name:"order-details",params:{id:r(I)}},variant:"outlined",color:"primary",size:"large","prepend-icon":r(ve)},{default:s(()=>[p(" الرجوع الى عرض الطلب ")]),_:1},8,["to","prepend-icon"]),r(u)?(w(),_e(xe,{key:0,order:r(u)},{default:s(()=>[o("form",{class:"px-8 py-3",onSubmit:a[8]||(a[8]=we((...e)=>r(U)&&r(U)(...e),["prevent"]))},[(w(!0),x(L,null,fe(_.value,(e,v)=>(w(),x("div",{key:e.id,class:"grid grid-cols-4 items-start"},[o("p",Be,d(e.name),1),t(k,{modelValue:i.value[v],"onUpdate:modelValue":c=>i.value[v]=c,class:"w-32",label:"الكمية",type:"number",variant:"outlined",color:"primary",placeholder:"الكمية",onInput:c=>ae(v)},null,8,["modelValue","onUpdate:modelValue","onInput"]),De,o("div",Pe,[o("p",null,d(e.price),1),t(K,{width:"500"},{activator:s(({props:c})=>[t(n,be(ge(c)),{default:s(()=>[t(ke,{fill:"fill-black","custom-style":"w-7 h-7 cursor-pointer"})]),_:2},1040)]),default:s(({isActive:c})=>[t(Q,{title:Z(e.name,e.id),rounded:"lg",color:"#EFE9F5",style:{"padding-block":"1.75rem !important"}},{default:s(()=>[t(R,null,{default:s(()=>[p(" سيتم حذف عدد "+d(e.minimum_quantity)+" "+d(e.minimum_quantity===1?"عنصر":"عناصر")+" بقيمة "+d(e.price)+" د.ل من هذه الطلبية. لا يمكن التراجع عن هذه العملية. ",1)]),_:2},1024),t(z,null,{default:s(()=>[t(Fe),t(n,{text:"لا",onClick:le=>c.value=!1},null,8,["onClick"]),t(n,{text:"نعم",onClick:le=>{ee(v,e.id),c.value=!1}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:2},1024)])]))),128)),o("div",Se,[t(n,{size:"small",rounded:"xl",variant:"elevated",color:"#004C6B",onClick:a[0]||(a[0]=e=>f.value.open=!0)},{default:s(()=>[p(" إضافة منتج ")]),_:1})]),t(K,{modelValue:f.value.open,"onUpdate:modelValue":a[4]||(a[4]=e=>f.value.open=e),class:"w-3/4 p-6"},{default:s(()=>[t(Q,null,{default:s(()=>[t(ye,null,{default:s(()=>[p("إضافة منتج للطلب")]),_:1}),t(R,null,{default:s(()=>{var e;return[t($e,{modelValue:N.value,"onUpdate:modelValue":a[1]||(a[1]=v=>N.value=v),"hide-no-data":!1,"item-title":"name","item-value":"id","return-object":!0,items:(e=r(M))==null?void 0:e.data,loading:r(H),"hide-selected":"",label:"المنتجات",placeholder:"المنتجات",variant:"outlined",color:"primary","auto-select-first":""},{"no-data":s(()=>[t(Ve,null,{default:s(()=>[t(he,null,{default:s(()=>[p(" لا توجد نتائج ")]),_:1})]),_:1})]),_:1},8,["modelValue","items","loading"])]}),_:1}),t(z,null,{default:s(()=>[t(n,{color:"primary",type:"submit",variant:"tonal",onClick:a[2]||(a[2]=e=>{te(N.value),f.value.open=!1})},{default:s(()=>[p(" إضافة ")]),_:1}),t(n,{color:"error",type:"button",onClick:a[3]||(a[3]=e=>f.value.open=!1)},{default:s(()=>[p(" الغاء ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o("div",Ee,[o("div",Ue,[je,o("p",null,d(E.value)+" د.ل",1)]),o("div",Oe,[Ae,o("p",null,d(r(Te)(r(u).order_details.due_date)),1)]),r(u).order_details.payment_method=="installments"?(w(),x("div",Le,[o("div",Qe,[Re,o("p",null,d(r(u).order_details.total_price_with_copupon),1)]),o("div",ze,[Ke,o("p",null,d(r(u).order_details.debt_ratio),1)]),o("div",Je,[o("div",Me,[t(k,{modelValue:r(b),"onUpdate:modelValue":a[5]||(a[5]=e=>F(b)?b.value=e:null),label:"متأخرات سداد الديون",placeholder:"متأخرات سداد الديون",type:"number",variant:"outlined","error-messages":r(T).debt_arrears,onInput:q},null,8,["modelValue","error-messages"])]),o("div",He,[t(k,{modelValue:r(y),"onUpdate:modelValue":a[6]||(a[6]=e=>F(y)?y.value=e:null),label:"المدفوع",placeholder:"المدفوع",type:"number",variant:"outlined","error-messages":r(T).paid_due_value,onInput:q},null,8,["modelValue","error-messages"])]),o("div",Ge,[t(k,{modelValue:r(g),"onUpdate:modelValue":a[7]||(a[7]=e=>F(g)?g.value=e:null),label:"الإجمالي بعد الإستحقاق",placeholder:"الإجمالي بعد الإستحقاق",type:"number",variant:"outlined","error-messages":r(T).residual_value,onInput:q},null,8,["modelValue","error-messages"])])])])):A("",!0)]),t(n,{size:"large",rounded:"xl",variant:"elevated",color:"#004C6B",type:"submit",loading:r(D).isPending.value},{default:s(()=>[p(" تحديث ")]),_:1},8,["loading"])],32)]),_:1},8,["order"])):A("",!0)],64))}});export{ia as default};
