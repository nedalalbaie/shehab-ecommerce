import{S as V,c as pe,b as he}from"./status-na5xpgos.js";import{d as J,c as T,f as s,t as g,g as N,h as f,bq as me,br as fe,bs as be,o as _,bt as ge,aY as ye,r as we,b as ve,e as _e,aP as Se,l as H,k as A,V as F,i as z,b0 as Ee,j as E,F as q,bu as Ce,x as xe,B as ke,C as Ae,A as Ne,H as Pe,I as Te,u as $e,aU as De,aR as Le,m as K,q as Me}from"./index-sE9P4Q9O.js";import{_ as Ve}from"./DeleteIcon.vue_vue_type_script_setup_true_lang-1ZPx5IJG.js";import{f as je}from"./format-date-q9jp0Fy1.js";import{V as Be}from"./VDialog-1Ku-f6d7.js";import{V as Re}from"./VSpacer-1dX4bruf.js";import{V as Fe}from"./VAlert-TSoO0zFn.js";import"./queryString-AL1HqB06.js";var Oe=Object.defineProperty,X=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,We=Object.prototype.propertyIsEnumerable,Z=(e,t,n)=>t in e?Oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ee=(e,t)=>{for(var n in t||(t={}))Ie.call(t,n)&&Z(e,n,t[n]);if(X)for(var n of X(t))We.call(t,n)&&Z(e,n,t[n]);return e},I=(e,t,n)=>new Promise((l,a)=>{var p=d=>{try{c(n.next(d))}catch(o){a(o)}},m=d=>{try{c(n.throw(d))}catch(o){a(o)}},c=d=>d.done?l(d.value):Promise.resolve(d.value).then(p,m);c((n=n.apply(e,t)).next())});function G(e){return!!e.shadowRoot}let te=!1;function qe(){if(te)return;class e extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}}customElements.define("vue-to-print-shadow-dom",e),te=!0}const He=`
  class VueToPrintShadowDom extends HTMLElement {
    constructor() {
      super();
      this.attachShadow({ mode: 'open' });
    }
  }
  customElements.define('vue-to-print-shadow-dom', VueToPrintShadowDom);
`;function ze(e){const t=e.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("vue-to-print-custom-script","registry-shadow-dom"),t.innerHTML=He,e.body.appendChild(t)}const Qe=`
  function retrieveStyleSheets(styleSheetMap) {
    styleSheetMap.forEach((styleSheetStrings, tagName) => {
      const styleSheets = [];
      for (let i = styleSheetStrings.length; i--;) {
        const styleSheet = new CSSStyleSheet();
        styleSheet.replaceSync(styleSheetStrings[i]);
        styleSheets.push(styleSheet);
      }

      const elements = document.querySelectorAll('vue-to-print-shadow-dom[original-tag-name=' + tagName + ']');
      for (let i = elements.length; i--;) {
        const element = elements[i];
        element.shadowRoot.adoptedStyleSheets = styleSheets;
      }
    });
  }
`;function Ye(e){const t=e.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("vue-to-print-custom-script","registry-retrieve-style-sheets-func"),t.innerHTML=Qe,e.body.appendChild(t)}const O=new Map;function ne(e){qe();const t=e.nodeName.toLowerCase(),n=e.shadowRoot.adoptedStyleSheets,l=document.createElement("vue-to-print-shadow-dom");l.setAttribute("original-tag-name",t),O.has(t)||O.set(t,new Set);const a=O.get(t);for(let c=n.length;c--;)a.add(n[c]);const p=l.attributes,m=e.attributes;for(let c=m.length;c--;)p.setNamedItem(m[c].cloneNode());return l}function Ue(){const e=new Map,t=new Map,n=Array.from(O.keys());for(let l=n.length;l--;){const a=[],p=n[l],m=Array.from(O.get(p));for(let c=m.length;c--;){const d=m[c];if(!t.has(d)){let o="";const r=Array.from(d.cssRules);for(let i=r.length;i--;)o+=r[i].cssText;t.set(d,o)}a.push(t.get(d))}e.set(p,a)}return e}function Ge(e){const t=e.contentWindow||null;if(!t)throw new Error("Cannot access print window");const n=t.document;if(!n)throw new Error("Cannot access print document");ze(n),Ye(n);const l=Ue();t.retrieveStyleSheets(l)}function oe(e){return!!customElements.get(e.nodeName.toLowerCase())}let se=!1;function Je(){if(se)return;class e extends HTMLElement{constructor(){super()}}customElements.define("vue-to-print-custom-element",e),se=!0}function re(e){Je();const t=e.nodeName.toLowerCase(),n=document.createElement("vue-to-print-custom-element");n.setAttribute("original-tag-name",t);const l=n.attributes,a=e.attributes;for(let p=a.length;p--;)l.setNamedItem(a[p].cloneNode());return n}function ie(e){return I(this,null,function*(){e.getAttribute("src")&&(e.complete||(yield new Promise((t,n)=>{e.addEventListener("load",t,{once:!0}),e.addEventListener("error",l=>n(l.error),{once:!0})})))})}function Ke(e){return I(this,null,function*(){e.readyState>=2||(yield new Promise((t,n)=>{e.addEventListener("loadeddata",t,{once:!0}),e.addEventListener("error",l=>n(l.error),{once:!0}),e.addEventListener("stalled",()=>n(new Error("Loading video stalled, skipping")),{once:!0})}))})}function Xe(e){const t=e.cloneNode(),n=t.getContext("2d");return n&&n.drawImage(e,0,0),t}function Ze(e,t){const n=e.cloneNode();return t.push(ie(n)),n}function et(e,t){const n=e.cloneNode();n.preload="auto";const l=n.getAttribute("poster");if(l){const a=new Image;a.src=l,t.push(ie(a))}else t.push(Ke(n));return n}function tt(e){const t=e.cloneNode();switch(e.type){case"checkbox":case"radio":t.checked=e.checked;break;default:t.value=e.value;break}return t}function nt(e){const t=e.cloneNode();return t.value=e.value,t}function ot(e){const t=e.cloneNode();return t.selected=e.selected,t}const le=new Map([["canvas",Xe],["img",Ze],["video",et],["input",tt],["select",nt],["option",ot]]);function st(e){return e.cloneNode()}function rt(e,t=[]){const n=e.nodeName.toLowerCase();return(le.has(n)?le.get(n):st)(e,t)}function lt(e){var t;if(e.nodeName.toLowerCase()==="slot"){const n=e.assignedNodes();return n.length>0?n:Array.from(e.childNodes)}else return Array.from(((t=e.shadowRoot)!=null?t:e).childNodes)}function it(e){return I(this,null,function*(){const t=new Map,n=[];let l;G(e)?l=ne(e):oe(e)?l=re(e):l=e.cloneNode(),t.set(e,l);const a=[e];for(;a.length;){const p=a.shift(),m=lt(p);if(m.length<=0)continue;const c=t.get(p),d=G(c)?c.shadowRoot:c;for(let o=0;o<m.length;o++){const r=m[o];let i;G(r)?i=ne(r):oe(r)?i=re(r):i=rt(r,n),t.set(r,i),a.push(r),d.appendChild(i)}}return yield Promise.all(n),l})}const at={copyStyles:!0,pageStyle:`
        @page {
            /* Remove browser default header (title) and footer (url) */
            margin: 0;
        }
        @media print {
            body {
                /* Tell browsers to print background colors */
                -webkit-print-color-adjust: exact; /* Chrome/Safari/Edge/Opera */
                color-adjust: exact; /* Firefox */
            }
        }
    `,removeAfterPrint:!1,suppressErrors:!1};function ct(e){e=ee(ee({},at),e);let t=0,n=[],l=[];const a=r=>{const{onAfterPrint:i,onPrintError:h,print:b,documentTitle:C}=e;setTimeout(()=>{var x,M;if(r.contentWindow)if(r.contentWindow.focus(),b)b(r).then(()=>i==null?void 0:i()).then(()=>d()).catch(u=>{h?h("print",u):o(["An error was thrown by the specified `print` function"])});else{if(r.contentWindow.print){const u=(M=(x=r.contentDocument)==null?void 0:x.title)!=null?M:"",W=r.ownerDocument.title;C&&(r.ownerDocument.title=C,r.contentDocument&&(r.contentDocument.title=C)),r.contentWindow.print(),C&&(r.ownerDocument.title=W,r.contentDocument&&(r.contentDocument.title=u))}else o(["Printing for this browser is not currently possible: the browser does not have a `print` method available for iframes."]);i==null||i(),d()}else o(["Printing failed because the `contentWindow` of the print iframe did not load. This is possibly an error with `vue-to-print`. Please file an issue: https://github.com/gregnb/react-to-print/issues/"])},500)},p=r=>{const{onBeforePrint:i,onPrintError:h}=e;if(i){const b=i();b&&typeof b.then=="function"?b.then(()=>{a(r)}).catch(C=>{h&&h("onBeforePrint",C)}):a(r)}else a(r)},m=()=>{const{onBeforeGetContent:r,onPrintError:i}=e;if(r){const h=r();h&&typeof h.then=="function"?h.then(c).catch(b=>{i&&i("onBeforeGetContent",b)}):c()}else c()},c=()=>I(this,null,function*(){const{bodyClass:r,content:i,copyStyles:h,fonts:b,pageStyle:C,nonce:x}=e,M=i();if(M===void 0){o(["To print a functional component ensure it is wrapped with `React.forwardRef`, and ensure the forwarded ref is used. See the README for an example: https://github.com/gregnb/react-to-print#examples"]);return}if(M===null){o(['There is nothing to print because the "content" prop returned "null". Please ensure "content" is renderable before allowing "vue-to-print" to be called.']);return}const u=document.createElement("iframe");u.width=`${document.documentElement.clientWidth}px`,u.height=`${document.documentElement.clientHeight}px`,u.style.position="absolute",u.style.top=`-${document.documentElement.clientHeight+100}px`,u.style.left=`-${document.documentElement.clientWidth+100}px`,u.id="printWindow",u.srcdoc="<!DOCTYPE html>";const W=M;if(!W){o(['"vue-to-print" could not locate the DOM node corresponding with the `content` prop']);return}const ae=yield it(W),ce=document.querySelectorAll("link[rel~='stylesheet']"),de=b?b.length:0;t=ce.length+de,n=[],l=[];const $=(D,j)=>{if(n.includes(D)){o(["Tried to mark a resource that has already been handled",D],"debug");return}j?(o(['"vue-to-print" was unable to load a resource but will continue attempting to print the page',...j]),l.push(D)):n.push(D),n.length+l.length===t&&p(u)};u.onload=()=>I(this,null,function*(){var D,j;u.onload=null;const S=u.contentDocument||((D=u.contentWindow)==null?void 0:D.document);if(S){S.body.appendChild(ae),b&&((j=u.contentDocument)!=null&&j.fonts&&typeof FontFace<"u"?b.forEach(y=>{const k=new FontFace(y.family,y.source,{weight:y.weight,style:y.style});u.contentDocument.fonts.add(k),k.loaded.then(()=>{$(k)}).catch(U=>{$(k,["Failed loading the font:",k,"Load error:",U])})}):(b.forEach(y=>$(y)),o(['"vue-to-print" is not able to load custom fonts because the browser does not support the FontFace API but will continue attempting to print the page'])));const Y=typeof C=="function"?C():C;if(typeof Y!="string")o([`"vue-to-print" expected a "string" from \`pageStyle\` but received "${typeof Y}". Styles from \`pageStyle\` will not be applied.`]);else{const y=S.createElement("style");x&&(y.setAttribute("nonce",x),S.head.setAttribute("nonce",x)),y.appendChild(S.createTextNode(Y)),S.head.appendChild(y)}if(r&&S.body.classList.add(...r.split(" ")),h){const y=document.querySelectorAll("style, link[rel~='stylesheet']");for(let k=0,U=y.length;k<U;++k){const w=y[k];if(w.tagName.toLowerCase()==="style"){const v=S.createElement(w.tagName),P=w.sheet;if(P){let B="";try{const L=P.cssRules.length;for(let R=0;R<L;++R)typeof P.cssRules[R].cssText=="string"&&(B+=`${P.cssRules[R].cssText}\r
`)}catch{o(["A stylesheet could not be accessed. This is likely due to the stylesheet having cross-origin imports, and many browsers block script access to cross-origin stylesheets. See https://github.com/gregnb/react-to-print/issues/429 for details. You may be able to load the sheet by both marking the stylesheet with the cross `crossorigin` attribute, and setting the `Access-Control-Allow-Origin` header on the server serving the stylesheet. Alternatively, host the stylesheet on your domain to avoid this issue entirely.",w],"warning")}v.setAttribute("id",`vue-to-print-${k}`),x&&v.setAttribute("nonce",x),v.appendChild(S.createTextNode(B)),S.head.appendChild(v)}}else if(w.getAttribute("href"))if(w.hasAttribute("disabled"))o(["`vue-to-print` encountered a <link> tag with a `disabled` attribute and will ignore it. Note that the `disabled` attribute is deprecated, and some browsers ignore it. You should stop using it. https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-disabled. The <link> is:",w],"warning"),$(w);else{const v=S.createElement(w.tagName);for(let P=0,B=w.attributes.length;P<B;++P){const L=w.attributes[P];L&&v.setAttribute(L.nodeName,L.nodeValue||"")}v.onload=()=>$(v),v.onerror=(P,B,L,R,ue)=>$(v,["Failed to load",v,"Error:",ue]),x&&v.setAttribute("nonce",x),S.head.appendChild(v)}else o(["`vue-to-print` encountered a <link> tag with an empty `href` attribute. In addition to being invalid HTML, this can cause problems in many browsers, and so the <link> was not loaded. The <link> is:",w],"warning"),$(w)}}}Ge(u),(t===0||!h)&&p(u)}),d(!0),document.body.appendChild(u)}),d=r=>{const{removeAfterPrint:i}=e;if(r||i){const h=document.getElementById("printWindow");h&&document.body.removeChild(h)}},o=(r,i="error")=>{const{suppressErrors:h}=e;h||(i==="error"?console.error(r):i==="warning"?console.warn(r):i==="debug"&&console.debug(r))};return{handlePrint:m}}const Q=e=>(me("data-v-75ee36a3"),e=e(),fe(),e),dt={class:"hidden print:flex flex-col items-center p-4",dir:"rtl"},ut=Q(()=>s("div",{class:"w-full flex justify-between"},[s("img",{class:"w-20 h-20",src:be})],-1)),pt={class:"w-full flex justify-between"},ht=Q(()=>s("h2",null,"ايصال مالي",-1)),mt={class:"w-full flex justify-between mt-2 pb-1 border-b-2 border-b-slate-300"},ft={class:"text-sm"},bt={class:"font-thin"},gt=Q(()=>s("span",{class:"font-thin"},"ايصال قبض",-1)),yt={class:"w-full mt-12"},wt={class:"font-thin"},vt={class:"w-full mt-4 flex justify-between"},_t={class:"font-thin"},St=Q(()=>s("span",null,[N(" نوع الدفع: "),s("span",{class:"font-thin"},"نقدا")],-1)),Et={class:"mt-4 w-full"},Ct={class:"font-semibold"},xt={class:"font-thin"},kt=J({__name:"PrintBill",props:{bill:{}},setup(e){return(t,n)=>(_(),T("div",dt,[ut,s("div",pt,[ht,s("h2",null,g(t.bill.bill_number),1)]),s("div",mt,[s("span",ft,[N(" التاريخ: "),s("span",bt,g(f(ge)(t.bill.created_at,"dd/MM/yyyy")),1)]),gt]),s("div",yt,[s("span",null,[N(" اسم الوافد: "),s("span",wt,g(t.bill.customer_name),1)])]),s("div",vt,[s("span",null,[N(" المبلغ و قدره: "),s("span",_t,g(t.bill.total_price),1)]),St]),s("div",Et,[s("p",Ct,[N(" المبلغ المدفــــــــــوع: "),s("span",xt,g(t.bill.total_price),1)])])]))}}),At=ye(kt,[["__scopeId","data-v-75ee36a3"]]),Nt={class:"print:hidden"},Pt={class:"flex items-center justify-between mt-6"},Tt={class:"text-3xl flex items-center gap-2"},$t={class:"flex gap-4"},Dt={class:"bg-white rounded-md shadow-md pt-6 mt-6"},Lt=s("div",{class:"bg-primary-100 text-white grid grid-cols-4 px-8 py-1"},[s("p",null,"الزبون"),s("p",null,"رقم الهاتف")],-1),Mt={class:"grid grid-cols-4 px-8 py-6"},Vt=s("p",null,null,-1),jt={class:"bg-white rounded-md shadow-md pt-6 mt-6"},Bt=s("div",{class:"bg-primary-100 text-white grid grid-cols-4 px-8 py-1"},[s("p",null,"العنصر"),s("p",null,"الكمية"),s("p",null,"اللون"),s("p",null,"السعر")],-1),Rt=J({__name:"BillDetails",props:{bill:{}},setup(e){const t=we(),{handlePrint:n}=ct({content:()=>t.value,documentTitle:"فاتورة",removeAfterPrint:!0,onAfterPrint:()=>{console.log("Printed")}}),l=()=>{setTimeout(()=>{console.log("inside set timeout print"),n()},50)},a=o=>`حذف الفاتورة ${o}# ?`,p=ve(),m=_e({mutationFn:pe,onSuccess:()=>{Pe.replace({name:"bills"}),p.invalidateQueries({queryKey:["bills"]})},onError:o=>{console.log(o)}}),c=(o,r)=>{m.mutate({bill_number:o,status:r})},d=o=>{switch(o){case V.CANCELD:return"ملغية";case V.ACCEPTED:return"تم التوصيل";default:return"تم التوصيل"}};return(o,r)=>(_(),T(q,null,[s("div",Nt,[s("div",Pt,[s("div",null,[s("h1",Tt,[N(" الفاتورة "+g(o.bill.result.bill_number)+"# - "+g(d(o.bill.result.status))+" ",1),s("div",{class:Se(["h-6 w-6 rounded-[50%]",{"bg-green-600":o.bill.result.status===f(V).ACCEPTED,"bg-red-600":o.bill.result.status===f(V).CANCELD}])},null,2)]),s("p",null,g(f(je)(o.bill.result.created_at)),1)]),s("div",$t,[o.bill.result.status==f(V).ACCEPTED?(_(),H(F,{key:0,variant:"tonal",class:"mx-1",density:"default",color:"primary",size:"large",rounded:"xl",type:"button","prepend-icon":f(Ce),onClick:r[0]||(r[0]=i=>l())},{default:A(()=>[N(" طباعة الفاتورة ")]),_:1},8,["prepend-icon"])):z("",!0),o.bill.result.status!=f(V).CANCELD?(_(),H(Be,{key:1,width:"500"},{activator:A(({props:i})=>[E(F,xe(i,{size:"large",rounded:"xl",variant:"elevated",color:"error",type:"submit"}),{prepend:A(()=>[E(Ve,{fill:"fill-white"})]),default:A(()=>[N(" إلغاء الفاتورة ")]),_:2},1040)]),default:A(({isActive:i})=>[E(Ne,{title:a(o.bill.result.bill_number),rounded:"lg",color:"#EFE9F5",style:{"padding-block":"1.75rem !important"}},{default:A(()=>[E(ke,null,{default:A(()=>[N(" سيتم الغاء هذه الطلبية بشكل نهائي، سيتلقى الزبون اشعارا يوضح ان الطلبية تم الغاؤها. ")]),_:1}),E(Ae,null,{default:A(()=>[E(Re),E(F,{text:"لا",onClick:h=>i.value=!1},null,8,["onClick"]),E(F,{text:"نعم",onClick:h=>{i.value=!1,c(o.bill.result.bill_number,"canceled")}},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["title"])]),_:1})):z("",!0)])]),s("div",Dt,[Lt,s("div",Mt,[s("p",null,g(o.bill.result.customer_name),1),s("p",null,g(o.bill.result.phone_number),1),Vt])]),s("div",jt,[Bt,Ee(o.$slots,"default")])]),s("div",{ref_key:"componentRef",ref:t,class:"hidden print:block"},[E(At,{bill:o.bill.result},null,8,["bill"])],512)],64))}}),Ft={key:0,class:"w-full h-96 flex items-center justify-center"},Ot={class:"border-b-2 border-neutral-600 pb-1 w-fit"},It={class:"w-4/5 flex gap-1"},Wt={class:"mt-2 w-1/4 rounded-tl-lg bg-primary-100 text-white p-3 text-xl"},qt={class:"flex justify-between"},Ht=s("p",null,"الإجمالي :",-1),zt={key:0,class:"flex justify-between mt-2"},Qt=s("p",null,"متأخرات سداد الديون :",-1),Yt=[Qt],nn=J({__name:"ViewBill",setup(e){const t=Te(),n=Number(t.params.id),{data:l,isPending:a,isError:p}=$e({queryKey:["bill"],queryFn:()=>he(n)}),m=c=>JSON.parse(c);return(c,d)=>(_(),T(q,null,[E(F,{to:{name:"bills"},variant:"outlined",color:"primary",size:"large","prepend-icon":f(De)},{default:A(()=>[N(" الرجوع الى الفواتير ")]),_:1},8,["prepend-icon"]),f(a)?(_(),T("div",Ft,[E(Le,{size:"50",width:"4",indeterminate:"",color:"primary"})])):f(p)?(_(),H(Fe,{key:1,type:"error",class:"my-6",title:"خطأ في الوصول الى بيانات الفاتورة",text:"الرجاء اعادة المحاولة مرة أخرى."})):f(l)?(_(),H(Rt,{key:2,bill:f(l)},{default:A(()=>[(_(!0),T(q,null,K(f(l).prodcts,o=>(_(),T("div",{key:o.id,class:"grid grid-cols-4 px-8 py-3"},[s("p",Ot,g(o.name),1),s("p",null,g(o.minimum_quantity),1),s("div",It,[(_(!0),T(q,null,K(m(o.hex_codes),(r,i)=>(_(),T("div",{key:i,class:"w-8 h-8 rounded-[50%] shadow-full-white border-2 flex items-end",style:Me({"background-color":`#${r}`})},null,4))),128))]),s("p",null,g(o.price),1)]))),128)),s("div",Wt,[s("div",qt,[Ht,s("p",null,g(f(l).result.total_price)+" د.ل",1)]),f(l).result.debt_arrears?(_(),T("div",zt,Yt)):z("",!0)])]),_:1},8,["bill"])):z("",!0)],64))}});export{nn as default};
